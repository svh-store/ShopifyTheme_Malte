{{ 'product-top.css' | asset_url | stylesheet_tag }}
<div class="product-top">
  <div class="product-top__gallery">
    <div class="product-top__main-image-wrapper">
      <button class="product-top__nav product-top__nav--prev" aria-label="Vorheriges Bild">&#9664;</button>
      <img id="ProductGalleryMain" loading="eager" width="500" height="500" class="product-top__main-image" src="{{ product.images.first | img_url: '500x500' }}" alt="{{ product.title }}">
      <button class="product-top__nav product-top__nav--next" aria-label="Nächstes Bild">&#9654;</button>
    </div>
    {% if product.images.size > 1 %}
    <ul class="product-top__thumbnails">
      {% for image in product.images %}
        <li class="product-top__thumbnail">
          <img loading="lazy" width="60" height="60" src="{{ image | img_url: '60x60' }}" alt="{{ image.alt | escape }}" data-index="{{ forloop.index0 }}">
        </li>
      {% endfor %}
    </ul>
    {% endif %}
  </div>
  <div class="product-top__info-card">
    <h1 class="product-top__title">{{ product.title }}</h1>
    <div class="product-top__rating">
      <div class="product-top__stars">
        {% for i in (1..5) %}
          <span class="product-top__star">&#9733;</span>
        {% endfor %}
      </div>
      {% if section.settings.rating_text != blank %}
        <span class="product-top__rating-text">{{ section.settings.rating_text }}</span>
      {% endif %}
    </div>
    {% assign feature_blocks = section.blocks | where: 'type', 'feature' %}
    {% if feature_blocks.size > 0 %}
      <ul class="product-top__features">
        {% for block in feature_blocks %}
          <li class="product-top__feature" {{ block.shopify_attributes }}>
            <span class="product-top__feature-icon">&#10003;</span>
            <span class="product-top__feature-text">{{ block.settings.text }}</span>
          </li>
        {% endfor %}
      </ul>
    {% endif %}
    <p class="product-top__price">{{ product.price | money }}</p>
    <p class="product-top__availability">Verfügbar – Lieferung in 5–7 Werktagen</p>
    {% if product.variants.size > 1 %}
      <ul class="product-top__variants">
        {% for variant in product.variants %}
          <li class="product-top__variant" data-variant-id="{{ variant.id }}">
            {% if variant.image %}
              <img loading="lazy" width="60" height="60" src="{{ variant.image | img_url: '60x60' }}" alt="{{ variant.title }}">
            {% else %}
              <span class="product-top__variant-title">{{ variant.title }}</span>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% endif %}
    {%- form 'product', product, class: 'product-top__form' -%}
      <button type="submit" class="product-top__add-to-cart" {% unless product.available %}disabled{% endunless %}>In den Warenkorb</button>
    {%- endform -%}
    {% assign service_blocks = section.blocks | where: 'type', 'service' %}
    {% if service_blocks.size > 0 %}
      <ul class="product-top__services">
        {% for block in service_blocks %}
          <li class="product-top__service" {{ block.shopify_attributes }}>
            <span class="product-top__service-icon"></span>
            <span class="product-top__service-text">{{ block.settings.text }}</span>
          </li>
        {% endfor %}
      </ul>
    {% endif %}
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var main = document.getElementById('ProductGalleryMain');
    var thumbs = document.querySelectorAll('.product-top__thumbnail img');
    var images = [{% for image in product.images %}'{{ image | img_url: '500x500' }}'{% unless forloop.last %},{% endunless %}{% endfor %}];
    var current = 0;
    function show(idx){
      if(idx < 0){ idx = images.length - 1; }
      if(idx >= images.length){ idx = 0; }
      current = idx;
      main.src = images[current];
    }
    thumbs.forEach(function(t){
      t.addEventListener('click', function(){ show(this.dataset.index); });
    });
    document.querySelector('.product-top__nav--prev').addEventListener('click', function(){ show(current - 1); });
    document.querySelector('.product-top__nav--next').addEventListener('click', function(){ show(current + 1); });
  });
</script>
{% schema %}
{
  "name": "Product Top",
  "settings": [
    {
      "type": "text",
      "id": "rating_text",
      "label": "Rating text"
    }
  ],
  "blocks": [
    {
      "type": "feature",
      "name": "Feature",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Feature text"
        }
      ]
    },
    {
      "type": "service",
      "name": "Service",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Service text"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product Top"
    }
  ]
}
{% endschema %}
